# Блог API - Интеграция с новой структурой данных

## Описание

Интеграция блога с новой структурой данных от API `http://localhost:8000/api/blog/notarialni-blog/`

## Новая структура API ответа

```json
{
  "count": 3,
  "next": "http://localhost:8000/api/blog/notarialni-blog/?lang=rw&page=3",
  "previous": "http://localhost:8000/api/blog/notarialni-blog/?lang=rw",
  "results": {
    "posts": [
      {
        "id": 2,
        "title": "Статья 1",
        "slug": "statya-1",
        "excerpt": "Статья 1 относится к Статье 1 Конституции Украины...",
        "cover": "/media/blog/covers/BlogCard2.png",
        "published_at": "2025-10-08",
        "status": true,
        "categories": [
          {
            "id": 3,
            "name": "Податок",
            "slug": "podatok",
            "show_in_filters": true
          }
        ]
      }
    ],
    "categories": [
      {
        "id": 3,
        "name": "Податок",
        "slug": "podatok",
        "show_in_filters": true
      }
    ]
  }
}
```

## Изменения в компонентах

### 1. BlogCard.jsx

- **Поддержка новой структуры данных**: Добавлена поддержка новых полей `slug`, `excerpt`, `cover`, `published_at`, `categories`
- **Обратная совместимость**: Сохранена поддержка старых полей `title`, `text`, `date`, `image`, `link`
- **Автоматическое формирование ссылок**: Если не указан `link`, формируется ссылка на основе `slug`
- **Обработка изображений**: Автоматическое добавление `BACKEND_BASE_URL` для изображений из `/media/`
- **Обрезание текста**: Автоматическое обрезание длинного текста с добавлением "..." в конце
- **Адаптивная длина**: Разная длина текста для PC и мобильных устройств

### 2. useBlog.js

- **Новая структура данных**: Обработка вложенной структуры `results.posts` и `results.categories`
- **Поддержка пагинации**: Автоматический расчет `totalPages` на основе `count`
- **Фильтрация по категориям**: Поддержка параметра `category` в URL
- **Языковая поддержка**: Автоматическое добавление `lang` параметра

### 3. MainBlogPage.jsx

- **Динамические категории**: Категории фильтров формируются из API
- **Состояния загрузки**: Показ `Loader` во время загрузки
- **Обработка ошибок**: Отображение ошибок API
- **Пустое состояние**: Сообщение когда нет статей
- **Переводы**: Интеграция с системой переводов

## Использование

### BlogCard

```jsx
// Новая структура данных
<BlogCard
  title="Заголовок статьи"
  slug="article-slug"
  excerpt="Краткое описание"
  cover="/media/blog/covers/image.jpg"
  published_at="2025-10-08"
  categories={[{ name: "Категория", slug: "category-slug" }]}
/>

// Старая структура (все еще работает)
<BlogCard
  title="Заголовок"
  text="Описание"
  date="10.01.2024"
  image="/path/to/image.jpg"
  link="/blog-article"
/>
```

### useBlog Hook

```jsx
// Базовое использование
const { articles, categories, loading, error, totalPages } = useBlog();

// С фильтрацией и пагинацией
const { articles, categories, loading, error, totalPages } = useBlog({
  page: 1,
  category: "podatok",
});
```

### MainBlogPage

```jsx
// Автоматически использует useBlog hook
// Поддерживает фильтрацию, пагинацию и переводы
<MainBlogPage />
```

## API Endpoints

### Основной endpoint

```
GET /api/blog/notarialni-blog/
```

### Query параметры

- `lang` - язык (ua, ru, en)
- `page` - номер страницы
- `category` - slug категории для фильтрации

### Примеры запросов

```
GET /api/blog/notarialni-blog/?lang=ua&page=1
GET /api/blog/notarialni-blog/?lang=ru&page=2&category=podatok
GET /api/blog/notarialni-blog/?lang=en&category=biznes
```

## Обработка изображений

### Автоматическое формирование URL

- Если `cover` начинается с `/media/` → добавляется `BACKEND_BASE_URL`
- Если `cover` уже полный URL → используется как есть
- Иначе → добавляется `/media/` к `BACKEND_BASE_URL`

### Примеры

```javascript
// Входные данные
cover: "/media/blog/covers/image.jpg";
// Результат: "http://localhost:8000/media/blog/covers/image.jpg"

cover: "https://example.com/image.jpg";
// Результат: "https://example.com/image.jpg"

cover: "blog/covers/image.jpg";
// Результат: "http://localhost:8000/media/blog/covers/image.jpg"
```

## Форматирование дат

### Автоматическое форматирование

- Входной формат: ISO 8601 (`2025-10-08`)
- Выходной формат: Украинский (`08.10.2025`)

## Обрезание текста

### Автоматическое обрезание

- **PC**: Максимум 120 символов
- **Мобильные**: Максимум 96 символов (80% от PC)
- **Добавление "...":** Автоматически добавляется в конце обрезанного текста

### Настройка длины

```jsx
// Стандартная длина (120 символов)
<BlogCard title="Заголовок" excerpt="Длинный текст..." />

// Кастомная длина
<BlogCard
  title="Заголовок"
  excerpt="Длинный текст..."
  maxTextLength={200}
/>
```

### Примеры обрезания

```javascript
// Исходный текст: 200 символов
const text =
  "Підтвердження достовірності підпису на документі є найбільш популярною нотаріальною послугою серед фізичних осіб. Обличчя самостійно...";

// PC (120 символов):
("Підтвердження достовірності підпису на документі є найбільш популярною нотаріальною послугою серед фізичних осіб. Обличчя самостійно...");

// Мобильные (96 символов):
("Підтвердження достовірності підпису на документі є найбільш популярною нотаріальною послугою серед фізичних осіб...");
```

## Обратная совместимость

Все изменения сохраняют обратную совместимость:

- Старые компоненты продолжают работать
- Старые API ответы обрабатываются корректно
- Постепенный переход на новую структуру данных

## Обработка ошибок

### 404 ошибки

- Возвращается пустой массив статей
- Показывается сообщение "Статті не знайдено"

### Другие ошибки

- Отображается сообщение об ошибке
- Логирование в консоль для отладки

## Пагинация

### Автоматическая пагинация

- **Бэкенд**: Использует `BlogPagination` с `page_size = 6`
- **Фронтенд**: Автоматически определяет количество страниц на основе `count` из API
- **URL параметры**: `page` - номер страницы (начинается с 1)

### Структура пагинации

```json
{
  "count": 7,
  "next": "http://localhost:8000/api/blog/notarialni-blog/?page=2",
  "previous": null,
  "results": {
    "posts": [...], // 6 статей на странице
    "categories": [...]
  }
}
```

### UI пагинации

- **Информация о количестве**: "Знайдено X статей"
- **Информация о странице**: "Сторінка 1 з 5"
- **Навигация**: Кнопки "Назад", "Вперед", номера страниц
- **Умная навигация**: Показ точек (...) для больших диапазонов

### Логика пагинации

```javascript
// Определение количества страниц
const pageSize = 6; // Из BlogPagination
const totalPages = Math.ceil(count / pageSize);

// Проверка наличия пагинации
const hasPagination = !!(data.next || data.previous);

// Пример для 7 статей: Math.ceil(7 / 6) = 2 страницы
```

## Производительность

### Кэширование

- Данные кэшируются в состоянии компонента
- Автоматическое обновление при изменении параметров

### Оптимизация

- Загрузка только необходимых данных
- Ленивая загрузка изображений через `OptimizedImage`
- Мемоизация компонентов где необходимо

### Логирование

```javascript
console.log("📊 Пагинация:", {
  count: data.count,
  currentPage: page,
  hasNext: !!data.next,
  hasPrevious: !!data.previous,
  articlesInResponse: data.results?.posts?.length || 0,
});
```
